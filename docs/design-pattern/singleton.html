<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-11-19 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>design-pattern &#x2013; 单例模式</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                design-pattern
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-11-19</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
                      </div>
            <div class="xright">                    <a href="./" title="design-pattern">design-pattern</a>
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                <h5>Parent Project</h5>
                  <ul>
                  <li class="none">
                          <a href="../index.html" title="java-learn">java-learn</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>&#x5355;&#x4f8b;&#x6a21;&#x5f0f;</h1>

<blockquote>
<p>&#x5355;&#x4f8b;&#x6a21;&#x5f0f;&#xff08;Singleton Pattern&#xff09;&#x662f; Java &#x4e2d;&#x6700;&#x7b80;&#x5355;&#x7684;&#x8bbe;&#x8ba1;&#x6a21;&#x5f0f;&#x4e4b;&#x4e00;&#x3002;&#x8fd9;&#x79cd;&#x7c7b;&#x578b;&#x7684;&#x8bbe;&#x8ba1;&#x6a21;&#x5f0f;&#x5c5e;&#x4e8e;&#x521b;&#x5efa;&#x578b;&#x6a21;&#x5f0f;&#xff0c;&#x5b83;&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x79cd;&#x521b;&#x5efa;&#x5bf9;&#x8c61;&#x7684;&#x6700;&#x4f73;&#x65b9;&#x5f0f;&#x3002; &#x8fd9;&#x79cd;&#x6a21;&#x5f0f;&#x6d89;&#x53ca;&#x5230;&#x4e00;&#x4e2a;&#x5355;&#x4e00;&#x7684;&#x7c7b;&#xff0c;&#x8be5;&#x7c7b;&#x8d1f;&#x8d23;&#x521b;&#x5efa;&#x81ea;&#x5df1;&#x7684;&#x5bf9;&#x8c61;&#xff0c;&#x540c;&#x65f6;&#x786e;&#x4fdd;&#x53ea;&#x6709;&#x5355;&#x4e2a;&#x5bf9;&#x8c61;&#x88ab;&#x521b;&#x5efa;&#x3002;&#x8fd9;&#x4e2a;&#x7c7b;&#x63d0;&#x4f9b;&#x4e86;&#x4e00;&#x79cd;&#x8bbf;&#x95ee;&#x5176;&#x552f;&#x4e00;&#x7684;&#x5bf9;&#x8c61;&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x53ef;&#x4ee5;&#x76f4;&#x63a5;&#x8bbf;&#x95ee;&#xff0c;&#x4e0d;&#x9700;&#x8981;&#x5b9e;&#x4f8b;&#x5316;&#x8be5;&#x7c7b;&#x7684;&#x5bf9;&#x8c61;</p>
</blockquote>
<div class="section">
<h2><a name="a1_"></a>1 &#x4ecb;&#x7ecd;</h2>

<ul>
  
<li>&#x610f;&#x56fe;&#xff1a;&#x4fdd;&#x8bc1;&#x4e00;&#x4e2a;&#x7c7b;&#x4ec5;&#x6709;&#x4e00;&#x4e2a;&#x5b9e;&#x4f8b;&#xff0c;&#x5e76;&#x63d0;&#x4f9b;&#x4e00;&#x4e2a;&#x8bbf;&#x95ee;&#x5b83;&#x7684;&#x5168;&#x5c40;&#x8bbf;&#x95ee;&#x70b9;&#x3002;</li>
  
<li>&#x4e3b;&#x8981;&#x89e3;&#x51b3;&#xff1a;&#x4e00;&#x4e2a;&#x5168;&#x5c40;&#x4f7f;&#x7528;&#x7684;&#x7c7b;&#x9891;&#x7e41;&#x5730;&#x521b;&#x5efa;&#x4e0e;&#x9500;&#x6bc1;</li>
  
<li>
<p>&#x4f7f;&#x7528;&#x573a;&#x666f;&#xff1a; </p>
  
<blockquote>
    
<blockquote>1&#x3001;&#x8981;&#x6c42;&#x751f;&#x4ea7;&#x552f;&#x4e00;&#x5e8f;&#x5217;&#x53f7;&#x3002;
    </blockquote>
  </blockquote></li>
</ul>

<blockquote>
  
<blockquote>
<p>2&#x3001;WEB &#x4e2d;&#x7684;&#x8ba1;&#x6570;&#x5668;&#xff0c;&#x4e0d;&#x7528;&#x6bcf;&#x6b21;&#x5237;&#x65b0;&#x90fd;&#x5728;&#x6570;&#x636e;&#x5e93;&#x91cc;&#x52a0;&#x4e00;&#x6b21;&#xff0c;&#x7528;&#x5355;&#x4f8b;&#x5148;&#x7f13;&#x5b58;&#x8d77;&#x6765;&#x3002; </p>
<p>3&#x3001;&#x521b;&#x5efa;&#x7684;&#x4e00;&#x4e2a;&#x5bf9;&#x8c61;&#x9700;&#x8981;&#x6d88;&#x8017;&#x7684;&#x8d44;&#x6e90;&#x8fc7;&#x591a;&#xff0c;&#x6bd4;&#x5982; I/O &#x4e0e;&#x6570;&#x636e;&#x5e93;&#x7684;&#x8fde;&#x63a5;&#x7b49;&#x3002;</p>
  </blockquote>
</blockquote>

<ul>
  
<li>
<p>&#x4f18;&#x70b9;&#xff1a; </p>
  
<blockquote>
    
<blockquote>1&#x3001;&#x5bf9;&#x4e8e;&#x9891;&#x7e41;&#x4f7f;&#x7528;&#x7684;&#x5bf9;&#x8c61;&#xff0c;&#x53ef;&#x4ee5;&#x7701;&#x7565;&#x521b;&#x5efa;&#x5bf9;&#x8c61;&#x6240;&#x82b1;&#x8d39;&#x7684;&#x65f6;&#x95f4;&#xff0c;&#x8fd9;&#x5bf9;&#x4e8e;&#x90a3;&#x4e9b;&#x91cd;&#x91cf;&#x7ea7;&#x5bf9;&#x8c61;&#x800c;&#x8a00;&#xff0c; &#x662f;&#x975e;&#x5e38;&#x53ef;&#x89c2;&#x7684;&#x4e00;&#x7b14;&#x7cfb;&#x7edf;&#x5f00;&#x9500;&#xff1b; &#x7531;&#x4e8e; new &#x64cd;&#x4f5c;&#x7684;&#x6b21;&#x6570;&#x51cf;&#x5c11;&#xff0c;&#x56e0;&#x800c;&#x5bf9;&#x7cfb;&#x7edf;&#x5185;&#x5b58;&#x7684;&#x4f7f;&#x7528;&#x9891;&#x7387;&#x4e5f;&#x4f1a;&#x964d;&#x4f4e;&#xff0c;&#x8fd9;&#x5c06;&#x51cf;&#x8f7b; GC &#x538b;&#x529b;&#xff0c;&#x7f29;&#x77ed; GC &#x505c;&#x987f;&#x65f6;&#x95f4;&#x3002;
    </blockquote>
  </blockquote></li>
</ul>

<blockquote>
  
<blockquote>
<p>2&#x3001;&#x907f;&#x514d;&#x5bf9;&#x8d44;&#x6e90;&#x7684;&#x591a;&#x91cd;&#x5360;&#x7528;&#xff08;&#x6bd4;&#x5982;&#x5199;&#x6587;&#x4ef6;&#x64cd;&#x4f5c;&#xff09;&#x3002;</p>
  </blockquote>
</blockquote>

<ul>
  
<li>&#x7f3a;&#x70b9;&#xff1a;&#x6ca1;&#x6709;&#x63a5;&#x53e3;&#xff0c;&#x4e0d;&#x80fd;&#x7ee7;&#x627f;&#xff0c;&#x4e0e;&#x5355;&#x4e00;&#x804c;&#x8d23;&#x539f;&#x5219;&#x51b2;&#x7a81;&#xff0c;&#x4e00;&#x4e2a;&#x7c7b;&#x5e94;&#x8be5;&#x53ea;&#x5173;&#x5fc3;&#x5185;&#x90e8;&#x903b;&#x8f91;&#xff0c;&#x800c;&#x4e0d;&#x5173;&#x5fc3;&#x5916;&#x9762;&#x600e;&#x4e48;&#x6837;&#x6765;&#x5b9e;&#x4f8b;&#x5316;&#x3002;</li>
</ul></div>
<div class="section">
<h2><a name="a2_"></a>2 &#x57fa;&#x672c;&#x5b9e;&#x73b0;</h2>

<blockquote>
<p>&#x5b9e;&#x73b0;&#x5355;&#x4f8b;&#x6a21;&#x5f0f;&#x9700;&#x8981;&#x6ce8;&#x610f;&#x4ee5;&#x4e0b;&#x51e0;&#x70b9;&#xff1a;</p>
  
<blockquote>
<p>1&#x3001;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;</p>
<p>2&#x3001;&#x5ef6;&#x8fdf;&#x52a0;&#x8f7d;</p>
<p>3&#x3001;&#x5e8f;&#x5217;&#x5316;&#x4e0e;&#x53cd;&#x5e8f;&#x5217;&#x5316;&#x5b89;&#x5168;</p>
  </blockquote>
</blockquote>
<div class="section">
<h3><a name="a2.1"></a>2.1</h3></div></div>
<div class="section">
<h2><a name="a3_"></a>3 &#x5177;&#x4f53;&#x5b9e;&#x73b0;</h2>

<blockquote>
<p>&#x8fd9;&#x91cc;&#x4e3b;&#x8981;&#x4ecb;&#x7ecd;&#x4e09;&#x79cd;&#x5b9e;&#x73b0;&#x65b9;&#x5f0f;&#xff1a;&#x61d2;&#x6c49;&#x5f0f;&#x5355;&#x4f8b;&#x3001;&#x997f;&#x6c49;&#x5f0f;&#x5355;&#x4f8b;&#x3001;&#x767b;&#x8bb0;&#x5f0f;&#x5355;&#x4f8b;&#x3001;&#x679a;&#x4e3e;&#x5f0f;&#x5355;&#x4f8b;</p>
</blockquote>
<div class="section">
<h3><a name="a"></a>&#x997f;&#x6c49;&#x5f0f;&#x548c;&#x61d2;&#x6c49;&#x5f0f;&#x533a;&#x522b;</h3>

<blockquote>
<p>&#x997f;&#x6c49;&#x5c31;&#x662f;&#x7c7b;&#x4e00;&#x65e6;&#x52a0;&#x8f7d;&#xff0c;&#x5c31;&#x628a;&#x5355;&#x4f8b;&#x521d;&#x59cb;&#x5316;&#x5b8c;&#x6210;&#xff0c;&#x4fdd;&#x8bc1;getInstance&#x7684;&#x65f6;&#x5019;&#xff0c;&#x5355;&#x4f8b;&#x662f;&#x5df2;&#x7ecf;&#x5b58;&#x5728;&#x7684;&#x3002; &#x61d2;&#x6c49;&#x6bd4;&#x8f83;&#x61d2;&#xff0c;&#x53ea;&#x6709;&#x5f53;&#x8c03;&#x7528;getInstance&#x7684;&#x65f6;&#x5019;&#xff0c;&#x624d;&#x56de;&#x53bb;&#x521d;&#x59cb;&#x5316;&#x8fd9;&#x4e2a;&#x5355;&#x4f8b;&#x3002;</p>
</blockquote>

<table border="0" class="bodyTable">
  <thead>
    
<tr class="a">
      
<th>&#x65b9;&#x5f0f; </th>
      
<th>&#x52a0;&#x8f7d;&#x8fc7;&#x7a0b; </th>
      
<th>&#x7ebf;&#x7a0b;&#x5b89;&#x5168; </th>
      
<th>&#x8d44;&#x6e90;&#x52a0;&#x8f7d;&#x548c;&#x6027;&#x80fd;</th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td>&#x997f;&#x6c49;&#x52a0;&#x8f7d; </td>
      
<td>&#x7c7b;&#x88ab;&#x521b;&#x5efa;&#x65f6; </td>
      
<td>&#x7ebf;&#x7a0b;&#x5b89;&#x5168; </td>
      
<td>&#x7b2c;&#x4e00;&#x6b21;&#x8c03;&#x7528;&#x65f6;&#x901f;&#x5ea6;&#x4f1a;&#x66f4;&#x5feb;&#xff0c;&#x56e0;&#x4e3a;&#x5176;&#x8d44;&#x6e90;&#x5df2;&#x7ecf;&#x521d;&#x59cb;&#x5316;&#x5b8c;&#x6210;</td>
    </tr>
    
<tr class="a">
      
<td>&#x61d2;&#x6c49;&#x52a0;&#x8f7d; </td>
      
<td>&#x5f53;&#x8c03;&#x7528;getInstance()&#x65b9;&#x6cd5;&#x65f6; </td>
      
<td>&#x975e;&#x7ebf;&#x7a0b;&#x5b89;&#x5168; </td>
      
<td>&#x7b2c;&#x4e00;&#x6b21;&#x8c03;&#x7528;&#x65f6;&#x8981;&#x505a;&#x521d;&#x59cb;&#x5316;&#xff0c;&#x5982;&#x679c;&#x8981;&#x505a;&#x7684;&#x5de5;&#x4f5c;&#x6bd4;&#x8f83;&#x591a;&#xff0c;&#x6027;&#x80fd;&#x4e0a;&#x4f1a;&#x6709;&#x4e9b;&#x5ef6;&#x8fdf;&#xff0c;&#x4e4b;&#x540e;&#x5c31;&#x548c;&#x997f;&#x6c49;&#x5f0f;&#x4e00;&#x6837;&#x4e86;&#x3002;</td>
    </tr>
  </tbody>
</table></div>
<div class="section">
<h3><a name="a3.1_"></a>3.1 &#x61d2;&#x6c49;&#x5f0f;&#x5355;&#x4f8b;&#x5b9e;&#x73b0;</h3></div>
<div class="section">
<h3><a name="a3.1.1_"></a>3.1.1 &#x975e;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#x5b9e;&#x73b0;</h3>
<p>![](image/ThreadUnSafeLazyLoadSingleton.png)</p>

<blockquote>
<p>&#x4ee3;&#x7801;&#x5b9e;&#x73b0;&#xff1a;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>private static volatile ThreadUnSafeLazyLoadSingleton ourInstance;

private static AtomicInteger initCount = new AtomicInteger(0);

public static ThreadUnSafeLazyLoadSingleton getInstance() {

    if (ourInstance == null) {
        ourInstance = new ThreadUnSafeLazyLoadSingleton();
    }
    return ourInstance;
}

// &#x6d4b;&#x8bd5;
private ThreadUnSafeLazyLoadSingleton() {
    int count = initCount.incrementAndGet(); // initCount.incrementAndGet() ; System.out.println(initCount); &#x4e3a;&#x4e24;&#x6b65;&#x64cd;&#x4f5c;
    log.info(&quot;-*--*--*--*- instance &#x521d;&#x59cb;&#x5316; &#x7b2c; {} &#x6b21;-*--*--*--*--&quot;, count);
}
</pre></div></div>

<blockquote>
<p>&#x6d4b;&#x8bd5;&#x4ee3;&#x7801;&#xff1a;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>public static void main(String[] args) {

    for (int i=0; i&lt;1000; i++){
        new Thread(ThreadUnSafeLazyLoadSingleton::getInstance).start();
    }

}
</pre></div></div>

<blockquote>
<p>&#x6d4b;&#x8bd5;&#x7ed3;&#x679c;&#xff1a;</p>
</blockquote>
<p>![](image/ThreadUnSafeLazyLoadSingletonTest.png)</p></div>
<div class="section">
<h3><a name="a3.1.2_getInstance"></a>3.1.2 &#x5728;getInstance&#x65b9;&#x6cd5;&#x4e0a;&#x52a0;&#x540c;&#x6b65;</h3>

<blockquote>
<p>&#x4ee3;&#x7801;&#x5b9e;&#x73b0;:</p>
</blockquote>

<div class="source">
<div class="source">
<pre>private static AtomicInteger initCount = new AtomicInteger(0);

public static synchronized ThreadSafeLazyLoadSyncSingleton getInstance() {
    if (ourInstance == null) {
        ourInstance = new ThreadSafeLazyLoadSyncSingleton();
    }
    return ourInstance;
}

private ThreadSafeLazyLoadSyncSingleton() {
    int count = initCount.incrementAndGet();
    log.info(&quot;-*--*--*--*- instance &#x521d;&#x59cb;&#x5316; &#x7b2c; {} &#x6b21;-*--*--*--*--&quot;, count);
}
</pre></div></div>

<blockquote>
<p>&#x6d4b;&#x8bd5;&#x4ee3;&#x7801;&#xff1a;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>public static void main(String[] args) {
    for (int i=0; i&lt;1000; i++){
        new Thread(ThreadSafeLazyLoadSyncSingleton.getInstance()::doWork).start();
    }
}
</pre></div></div>

<blockquote>
<p>&#x6d4b;&#x8bd5;&#x7ed3;&#x679c;&#xff1a;</p>
</blockquote>
<p>![](image/ThreadSafeLazyLoadSyncSingletonTest.png)</p></div>
<div class="section">
<h3><a name="a3.1.3_"></a>3.1.3 &#x4f7f;&#x7528;&#x53cc;&#x91cd;&#x6821;&#x9a8c;&#x9501;</h3>

<blockquote>
<p>&#x53cc;&#x91cd;&#x6821;&#x9a8c;&#x9501;&#x662f;&#x5728;3.1.2&#x57fa;&#x7840;&#x4e0a;&#x6539;&#x8fdb;&#x800c;&#x6765;&#xff0c;</p>
<p>&#x4ee3;&#x7801;&#x5b9e;&#x73b0;:</p>
</blockquote>

<div class="source">
<div class="source">
<pre>public static ThreadSafeDoubleCheckLocking getInstance() {

        if (ourInstance == null){                       //  &#x7b2c;&#x4e00;&#x6b21; null&#x503c; &#x6821;&#x9a8c;
            synchronized (ThreadSafeDoubleCheckLocking.class){
                if (ourInstance == null) {              //  &#x7b2c;&#x4e8c;&#x6b21; null&#x503c; &#x6821;&#x9a8c;
                    ourInstance = new ThreadSafeDoubleCheckLocking();
                }
            }
        }
        return ourInstance;
 }
</pre></div></div></div>
<div class="section">
<h3><a name="a3.1.4_"></a>3.1.4 &#x4f7f;&#x7528;&#x9759;&#x6001;&#x5185;&#x90e8;&#x7c7b;</h3>

<blockquote>
<p>&#x4f7f;&#x7528;jvm&#x7684;&#x7c7b;&#x52a0;&#x8f7d;&#x673a;&#x5236;&#x4fdd;&#x8bc1;&#x7a0b;&#x5e8f;&#x53ea;&#x521b;&#x5efa;&#x4e00;&#x4efd;&#x5b9e;&#x4f8b;&#x7684;&#x540c;&#x4e8b;&#x6709;&#x4fdd;&#x8bc1;&#x4e86;&#x4f7f;&#x7528;&#x61d2;&#x52a0;&#x8f7d;&#x7684;&#x65b9;&#x5f0f;&#x5b9e;&#x4f8b;&#x5316;&#x3002;</p>
<p>&#x4ee3;&#x7801;&#x5b9e;&#x73b0;:</p>
</blockquote>

<div class="source">
<div class="source">
<pre>public static InitializingOnDemandHolderIdiom getInstance() {
    return HelperHolder.INSTANCE;
}

private InitializingOnDemandHolderIdiom() {
    int count = initCount.incrementAndGet();
    log.info(&quot;-*--*--*--*- instance &#x521d;&#x59cb;&#x5316; &#x7b2c; {} &#x6b21;-*--*--*--*--&quot;, count);
}

public static class HelperHolder{
    private static  final InitializingOnDemandHolderIdiom INSTANCE = new InitializingOnDemandHolderIdiom();
}
</pre></div></div></div></div>
<div class="section">
<h2><a name="a3.2_"></a>3.2 &#x997f;&#x6c49;&#x5f0f;&#x5355;&#x4f8b;&#x5b9e;&#x73b0;</h2>

<blockquote>
<p>&#x997f;&#x6c49;&#x5f0f;&#x5355;&#x4f8b;&#x5b9e;&#x73b0;&#x662f;&#x5929;&#x751f;&#x7684;&#x7ebf;&#x7a0b;&#x5b89;&#x5168;&#xff0c;&#x5b9e;&#x73b0;&#x8d77;&#x6765;&#x4e5f;&#x6bd4;&#x8f83;&#x7b80;&#x5355;&#x3002;</p>
<p>&#x4ee3;&#x7801;&#x5b9e;&#x73b0;&#xff1a;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>private static final Singleton ourInstance = new Singleton();
</pre></div></div></div>
<div class="section">
<h2><a name="a3.3_"></a>3.3 &#x679a;&#x4e3e;&#x5355;&#x4f8b;&#x5b9e;&#x73b0;</h2>

<blockquote>
<p>&#x8fd9;&#x79cd;&#x65b9;&#x5f0f;&#x662f;Effective Java&#x4f5c;&#x8005;Josh Bloch &#x63d0;&#x5021;&#x7684;&#x65b9;&#x5f0f;&#xff0c;&#x5b83;&#x4e0d;&#x4ec5;&#x80fd;&#x907f;&#x514d;&#x591a;&#x7ebf;&#x7a0b;&#x540c;&#x6b65;&#x95ee;&#x9898;&#xff0c;&#x800c;&#x4e14;&#x8fd8;&#x80fd;&#x9632;&#x6b62;&#x53cd;&#x5e8f;&#x5217;&#x5316;&#x91cd;&#x65b0;&#x521b;&#x5efa;&#x65b0;&#x7684;&#x5bf9;&#x8c61;&#x3002;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>public enum  EnumSingleton {

    INSTANCE;

    public void doWork(){
        log.info(&quot;-*--*--*--*- doWork -*--*--*--*--&quot;);
    }
}
</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2017.
          All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
