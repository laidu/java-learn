<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.7.4 at 2017-12-12 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>mockito &#x2013; mockito 使用教程</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
        
          <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1402675-6']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    </head>
  <body class="composite">
    <div id="banner">
                    <div id="bannerLeft">
                mockito
                </div>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
                <div class="xleft">
        <span id="publishDate">Last Published: 2017-12-12</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0-SNAPSHOT</span>
                          |                           <a href="../../" title="Maven skin">Maven skin</a>
        &gt;
                          <a href="../index.html" title="framework">framework</a>
        &gt;
                          <a href="index.html" title="mockito">mockito</a>
        &gt;
    mockito 使用教程
              </div>
            <div class="xright">      
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
                                      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                 
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <h1>mockito &#x4f7f;&#x7528;&#x6559;&#x7a0b;</h1>
<p><a class="externalLink" href="http://static.javadoc.io/org.mockito/mockito-core/2.9.0/index.html?org/mockito/Mockito.html">&#x53c2;&#x8003; mockito 2.9.0 JavaDoc</a></p>

<blockquote>
<p>Mockito&#x662f;mocking&#x6846;&#x67b6;&#xff0c;&#x5b83;&#x8ba9;&#x4f60;&#x7528;&#x7b80;&#x6d01;&#x7684;API&#x505a;&#x6d4b;&#x8bd5;&#x3002;&#x800c;&#x4e14;Mockito&#x7b80;&#x5355;&#x6613;&#x5b66;&#xff0c;&#x5b83;&#x53ef;&#x8bfb;&#x6027;&#x5f3a;&#x548c;&#x9a8c;&#x8bc1;&#x8bed;&#x6cd5;&#x7b80;&#x6d01;&#x3002;</p>
</blockquote>
<div class="section">
<h2><a name="a1_mockito"></a>1 mockito&#x76f8;&#x5173;&#x4ecb;&#x7ecd;</h2>
<div class="section">
<h3><a name="a1.1_Mock"></a>1.1 &#x4e3a;&#x4ec0;&#x4e48;&#x9700;&#x8981;Mock</h3>

<blockquote>
<p>&#x6d4b;&#x8bd5;&#x9a71;&#x52a8;&#x7684;&#x5f00;&#x53d1;( TDD)&#x8981;&#x6c42;&#x6211;&#x4eec;&#x5148;&#x5199;&#x5355;&#x5143;&#x6d4b;&#x8bd5;&#xff0c;&#x518d;&#x5199;&#x5b9e;&#x73b0;&#x4ee3;&#x7801;&#x3002; &#x5728;&#x5199;&#x5355;&#x5143;&#x6d4b;&#x8bd5;&#x7684;&#x8fc7;&#x7a0b;&#x4e2d;&#xff0c;&#x6211;&#x4eec;&#x5f80;&#x5f80;&#x4f1a;&#x9047;&#x5230;&#x8981;&#x6d4b;&#x8bd5;&#x7684;&#x7c7b;&#x6709;&#x5f88;&#x591a;&#x4f9d;&#x8d56;&#xff0c; &#x8fd9;&#x4e9b;&#x4f9d;&#x8d56;&#x7684;&#x7c7b;/&#x5bf9;&#x8c61;/&#x8d44;&#x6e90;&#x53c8;&#x6709;&#x522b;&#x7684;&#x4f9d;&#x8d56;&#xff0c;&#x4ece;&#x800c;&#x5f62;&#x6210;&#x4e00;&#x4e2a;&#x5927;&#x7684;&#x4f9d;&#x8d56;&#x6811;&#xff0c; &#x8981;&#x5728;&#x5355;&#x5143;&#x6d4b;&#x8bd5;&#x7684;&#x73af;&#x5883;&#x4e2d;&#x5b8c;&#x6574;&#x5730;&#x6784;&#x5efa;&#x8fd9;&#x6837;&#x7684;&#x4f9d;&#x8d56;&#xff0c;&#x662f;&#x4e00;&#x4ef6;&#x5f88;&#x56f0;&#x96be;&#x7684;&#x4e8b;&#x60c5;&#x3002;</p>
</blockquote></div>
<div class="section">
<h3><a name="a1.2_StubMock"></a>1.2 Stub&#x548c;Mock&#x5f02;&#x540c;</h3>

<blockquote>
  
<ul>
    
<li>&#x76f8;&#x540c;&#xff1a;Stub&#x548c;Mock&#x90fd;&#x662f;&#x6a21;&#x62df;&#x5916;&#x90e8;&#x4f9d;&#x8d56;&#x3002;</li>
    
<li>&#x4e0d;&#x540c;&#xff1a;Stub&#x662f;&#x5b8c;&#x5168;&#x6a21;&#x62df;&#x4e00;&#x4e2a;&#x5916;&#x90e8;&#x4f9d;&#x8d56;&#xff0c;&#x800c;Mock&#x8fd8;&#x53ef;&#x4ee5;&#x7528;&#x6765;&#x5224;&#x65ad;&#x6d4b;&#x8bd5;&#x901a;&#x8fc7;&#x8fd8;&#x662f;&#x5931;&#x8d25;&#x3002;</li>
  </ul>
</blockquote></div></div>
<div class="section">
<h2><a name="a2_mockito"></a>2 &#x4f7f;&#x7528;mockito</h2>

<blockquote>
<p>&#x6dfb;&#x52a0;Maven&#x4f9d;&#x8d56;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>&lt;dependency&gt;
   &lt;groupId&gt;org.mockito&lt;/groupId&gt;
   &lt;artifactId&gt;mockito-core&lt;/artifactId&gt;
   &lt;version&gt;2.9.0&lt;/version&gt;
   &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</pre></div></div>

<blockquote>
<p>&#x6dfb;&#x52a0;Junit&#x4f9d;&#x8d56;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;junit&lt;/groupId&gt;
    &lt;artifactId&gt;junit&lt;/artifactId&gt;
    &lt;version&gt;4.12&lt;/version&gt;
    &lt;scope&gt;test&lt;/scope&gt;
&lt;/dependency&gt;
</pre></div></div>

<blockquote>
<p>&#x6dfb;&#x52a0;&#x5f15;&#x7528;</p>
</blockquote>

<div class="source">
<div class="source">
<pre>import static org.mockito.Mockito.*;
import static org.junit.Assert.*;
</pre></div></div></div>
<div class="section">
<h2><a name="a3_"></a>3 &#x5e38;&#x7528;&#x7684;&#x6d4b;&#x8bd5;&#x65b9;&#x6cd5;</h2>
<div class="section">
<h3><a name="a3.1_"></a>3.1 &#x9a8c;&#x8bc1;&#x67d0;&#x4e9b;&#x884c;&#x4e3a;</h3>

<div class="source">
<div class="source">
<pre>  // &#x9759;&#x6001;&#x5bfc;&#x5165;&#x4f1a;&#x4f7f;&#x4ee3;&#x7801;&#x66f4;&#x7b80;&#x6d01;
  import static org.mockito.Mockito.*;

  // mock creation &#x521b;&#x5efa;mock&#x5bf9;&#x8c61;
  List mockedList = mock(List.class);

  //using mock object &#x4f7f;&#x7528;mock&#x5bf9;&#x8c61;
  mockedList.add(&quot;one&quot;);
  mockedList.clear();

  //verification &#x9a8c;&#x8bc1;
  verify(mockedList).add(&quot;one&quot;);
  verify(mockedList).clear();
</pre></div></div>

<blockquote>
<p>&#x4e00;&#x65e6;mock&#x5bf9;&#x8c61;&#x88ab;&#x521b;&#x5efa;&#x4e86;&#xff0c;mock&#x5bf9;&#x8c61;&#x4f1a;&#x8bb0;&#x4f4f;&#x6240;&#x6709;&#x7684;&#x4ea4;&#x4e92;&#x3002;&#x7136;&#x540e;&#x4f60;&#x5c31;&#x53ef;&#x80fd;&#x9009;&#x62e9;&#x6027;&#x7684;&#x9a8c;&#x8bc1;&#x4f60;&#x611f;&#x5174;&#x8da3;&#x7684;&#x4ea4;&#x4e92;&#x3002;</p>
</blockquote></div>
<div class="section">
<h3><a name="a3.2__Stub"></a>3.2 &#x5982;&#x4f55;&#x505a;&#x4e00;&#x4e9b;&#x6d4b;&#x8bd5;&#x6869; (Stub)</h3>

<div class="source">
<div class="source">
<pre> //You can mock concrete classes, not only interfaces
 // &#x4f60;&#x53ef;&#x4ee5;mock&#x5177;&#x4f53;&#x7684;&#x7c7b;&#x578b;,&#x4e0d;&#x4ec5;&#x53ea;&#x662f;&#x63a5;&#x53e3;
 LinkedList mockedList = mock(LinkedList.class);

 //stubbing
 // &#x6d4b;&#x8bd5;&#x6869;
 when(mockedList.get(0)).thenReturn(&quot;first&quot;);
 when(mockedList.get(1)).thenThrow(new RuntimeException());

 //following prints &quot;first&quot;
 // &#x8f93;&#x51fa;&#x201c;first&#x201d;
 System.out.println(mockedList.get(0));

 //following throws runtime exception
 // &#x629b;&#x51fa;&#x5f02;&#x5e38;
 System.out.println(mockedList.get(1));

 //following prints &quot;null&quot; because get(999) was not stubbed
 // &#x56e0;&#x4e3a;get(999) &#x6ca1;&#x6709;&#x6253;&#x6869;&#xff0c;&#x56e0;&#x6b64;&#x8f93;&#x51fa;null
 System.out.println(mockedList.get(999));

 //Although it is possible to verify a stubbed invocation, usually it's just redundant
 //If your code cares what get(0) returns then something else breaks (often before even verify() gets executed).
 //If your code doesn't care what get(0) returns then it should not be stubbed. Not convinced? See here.
 // &#x9a8c;&#x8bc1;get(0)&#x88ab;&#x8c03;&#x7528;&#x7684;&#x6b21;&#x6570;
 verify(mockedList).get(0);
</pre></div></div>

<blockquote>
  
<ul>
    
<li>&#x9ed8;&#x8ba4;&#x60c5;&#x51b5;&#x4e0b;&#xff0c;&#x6240;&#x6709;&#x7684;&#x51fd;&#x6570;&#x90fd;&#x6709;&#x8fd4;&#x56de;&#x503c;&#x3002;mock&#x51fd;&#x6570;&#x9ed8;&#x8ba4;&#x8fd4;&#x56de;&#x7684;&#x662f;null&#xff0c;&#x4e00;&#x4e2a;&#x7a7a;&#x7684;&#x96c6;&#x5408;&#x6216;&#x8005;&#x4e00;&#x4e2a;&#x88ab;&#x5bf9;&#x8c61;&#x7c7b;&#x578b;&#x5305;&#x88c5;&#x7684;&#x5185;&#x7f6e;&#x7c7b;&#x578b;&#xff0c;&#x4f8b;&#x5982;0&#x3001;false&#x5bf9;&#x5e94;&#x7684;&#x5bf9;&#x8c61;&#x7c7b;&#x578b;&#x4e3a;Integer&#x3001;Boolean&#xff1b;</li>
    
<li>&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x53ef;&#x4ee5;&#x88ab;&#x8986;&#x5199; : &#x4f8b;&#x5982;&#x5e38;&#x89c1;&#x7684;&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x53ef;&#x4ee5;&#x7528;&#x4e8e;&#x521d;&#x59cb;&#x5316;&#x5939;&#x5177;&#xff0c;&#x4f46;&#x662f;&#x6d4b;&#x8bd5;&#x51fd;&#x6570;&#x80fd;&#x591f;&#x8986;&#x5199;&#x5b83;&#x3002;&#x8bf7;&#x6ce8;&#x610f;&#xff0c;&#x8986;&#x5199;&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x662f;&#x4e00;&#x79cd;&#x53ef;&#x80fd;&#x5b58;&#x5728;&#x6f5c;&#x5728;&#x95ee;&#x9898;&#x7684;&#x505a;&#x6cd5;&#xff1b;</li>
    
<li>&#x4e00;&#x65e6;&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x88ab;&#x8c03;&#x7528;&#xff0c;&#x8be5;&#x51fd;&#x6570;&#x5c06;&#x4f1a;&#x4e00;&#x81f4;&#x8fd4;&#x56de;&#x56fa;&#x5b9a;&#x7684;&#x503c;&#xff1b;</li>
    
<li>&#x4e0a;&#x4e00;&#x6b21;&#x8c03;&#x7528;&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x6709;&#x65f6;&#x5019;&#x6781;&#x4e3a;&#x91cd;&#x8981;-&#x5f53;&#x4f60;&#x8c03;&#x7528;&#x4e00;&#x4e2a;&#x51fd;&#x6570;&#x5f88;&#x591a;&#x6b21;&#x65f6;&#xff0c;&#x6700;&#x540e;&#x4e00;&#x6b21;&#x8c03;&#x7528;&#x53ef;&#x80fd;&#x662f;&#x4f60;&#x6240;&#x611f;&#x5174;&#x8da3;&#x7684;&#x3002;</li>
  </ul>
</blockquote></div>
<div class="section">
<h3><a name="a3.3__matchers"></a>3.3 &#x53c2;&#x6570;&#x5339;&#x914d;&#x5668; (matchers)</h3>
<p>Mockito&#x4ee5;&#x81ea;&#x7136;&#x7684;java&#x98ce;&#x683c;&#x6765;&#x9a8c;&#x8bc1;&#x53c2;&#x6570;&#x503c;: &#x4f7f;&#x7528;equals()&#x51fd;&#x6570;&#x3002;&#x6709;&#x65f6;&#xff0c;&#x5f53;&#x9700;&#x8981;&#x989d;&#x5916;&#x7684;&#x7075;&#x6d3b;&#x6027;&#x65f6;&#x4f60;&#x53ef;&#x80fd;&#x9700;&#x8981;&#x4f7f;&#x7528;&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;&#xff0c;&#x4e5f;&#x5c31;&#x662f;argument matchers :</p>

<div class="source">
<div class="source">
<pre> //stubbing using built-in anyInt() argument matcher
 // &#x4f7f;&#x7528;&#x5185;&#x7f6e;&#x7684;anyInt()&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;
 when(mockedList.get(anyInt())).thenReturn(&quot;element&quot;);

 //stubbing using custom matcher (let's say isValid() returns your own matcher implementation):
 // &#x4f7f;&#x7528;&#x81ea;&#x5b9a;&#x4e49;&#x7684;&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;( &#x5728;isValid()&#x51fd;&#x6570;&#x4e2d;&#x8fd4;&#x56de;&#x4f60;&#x81ea;&#x5df1;&#x7684;&#x5339;&#x914d;&#x5668;&#x5b9e;&#x73b0; )
 when(mockedList.contains(argThat(isValid()))).thenReturn(&quot;element&quot;);

 //following prints &quot;element&quot;
 // &#x8f93;&#x51fa;element
 System.out.println(mockedList.get(999));

 //you can also verify using an argument matcher
 // &#x4f60;&#x4e5f;&#x53ef;&#x4ee5;&#x9a8c;&#x8bc1;&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;
 verify(mockedList).get(anyInt());
</pre></div></div>

<blockquote>
<p>&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;&#x7684;&#x6ce8;&#x610f;&#x70b9; : </p>
<p>&#x5982;&#x679c;&#x4f60;&#x4f7f;&#x7528;&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;,&#x6240;&#x6709;&#x53c2;&#x6570;&#x90fd;&#x5fc5;&#x987b;&#x7531;&#x5339;&#x914d;&#x5668;&#x63d0;&#x4f9b;&#x3002;</p>
<p>&#x793a;&#x4f8b; : ( &#x8be5;&#x793a;&#x4f8b;&#x5c55;&#x793a;&#x4e86;&#x5982;&#x4f55;&#x591a;&#x6b21;&#x5e94;&#x7528;&#x4e8e;&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x7684;&#x9a8c;&#x8bc1; ) </p>
</blockquote>

<div class="source">
<div class="source">
<pre>verify(mock).someMethod(anyInt(), anyString(), eq(&quot;third argument&quot;));
//above is correct - eq() is also an argument matcher
// &#x4e0a;&#x8ff0;&#x4ee3;&#x7801;&#x662f;&#x6b63;&#x786e;&#x7684;,&#x56e0;&#x4e3a;eq()&#x4e5f;&#x662f;&#x4e00;&#x4e2a;&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;

verify(mock).someMethod(anyInt(), anyString(), &quot;third argument&quot;);
//above is incorrect - exception will be thrown because third argument 
// &#x4e0a;&#x8ff0;&#x4ee3;&#x7801;&#x662f;&#x9519;&#x8bef;&#x7684;,&#x56e0;&#x4e3a;&#x6240;&#x6709;&#x53c2;&#x6570;&#x5fc5;&#x987b;&#x7531;&#x5339;&#x914d;&#x5668;&#x63d0;&#x4f9b;&#xff0c;&#x800c;&#x53c2;&#x6570;&quot;third argument&quot;&#x5e76;&#x975e;&#x7531;&#x53c2;&#x6570;&#x5339;&#x914d;&#x5668;&#x63d0;&#x4f9b;&#xff0c;&#x56e0;&#x6b64;&#x7684;&#x7f18;&#x6545;&#x4f1a;&#x629b;&#x51fa;&#x5f02;&#x5e38;
</pre></div></div>

<blockquote>
<p>&#x50cf;anyObject(), eq()&#x8fd9;&#x6837;&#x7684;&#x5339;&#x914d;&#x5668;&#x51fd;&#x6570;&#x4e0d;&#x4f1a;&#x8fd4;&#x56de;&#x5339;&#x914d;&#x5668;&#x3002;&#x5b83;&#x4eec;&#x4f1a;&#x5728;&#x5185;&#x90e8;&#x5c06;&#x5339;&#x914d;&#x5668;&#x8bb0;&#x5f55;&#x5230;&#x4e00;&#x4e2a;&#x6808;&#x5f53;&#x4e2d;&#xff0c;&#x5e76;&#x4e14;&#x8fd4;&#x56de;&#x4e00;&#x4e2a;&#x5047;&#x7684;&#x503c;&#xff0c;&#x901a;&#x5e38;&#x4e3a;null&#x3002;<tt>&#x8fd9;&#x6837;&#x7684;&#x5b9e;&#x73b0;&#x662f;&#x7531;&#x4e8e;&#x88ab;Java&#x7f16;&#x8bd1;&#x5668;&#x5f3a;&#x52a0;&#x7684;&#x9759;&#x6001;&#x7c7b;&#x578b;&#x5b89;&#x5168;</tt>&#x3002;&#x7ed3;&#x679c;&#x5c31;&#x662f;&#x4f60;&#x4e0d;&#x80fd;&#x5728;&#x9a8c;&#x8bc1;&#x6216;&#x8005;&#x6d4b;&#x8bd5;&#x6869;&#x51fd;&#x6570;&#x4e4b;&#x5916;&#x4f7f;&#x7528;anyObject(), eq()&#x51fd;&#x6570;&#x3002;</p>
</blockquote></div></div>
<div class="section">
<h2><a name="a4_mockitoSpring"></a>4 mockito&#x5728;Spring&#x4e2d;&#x7684;&#x5e94;&#x7528;</h2></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                   2017.
          All rights reserved.    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
